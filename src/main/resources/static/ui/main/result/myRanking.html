<meta charset="utf-8">
<script type="text/javascript">
	var <@pageId> = {
		 thisYear:''
		,thisYearMonth:''
		,lastYear:''
		,lastYearMonth:''
		,createChart 		: (container, categories, series, unit)=>_createChart(container, categories, series, null,null,unit)

		,pageInit  : () =>{

			<@pageId>.thisYear = dayjs().year();
			<@pageId>.thisYearMonth = dayjs().year()+("0"+(dayjs().month()+1)).slice(-2);
			<@pageId>.lastYear = <@pageId>.thisYear - 1;
			<@pageId>.lastYearMonth = (<@pageId>.thisYear - 1)+("0"+(dayjs().month()+1)).slice(-2);
		}
		,chartInit : () =>{
			
			//월별 매출 누적합계 , 전월대비 매출 증감분 , 계약 건수(전체)
 			var parm = {
				queryGroup : [{queryId	: "rstMgn.getMyPaymentList"		,requestParm	: {GUBUN:'FA' , UNIT_TYPE : G_VAL.session.etcUserInfo["UNIT_TYPE"]}}
							 ,{queryId 	: "rstMgn.getContarctCntList"	,requestParm	: {GUBUN:'FA' , UNIT_TYPE : G_VAL.session.etcUserInfo["UNIT_TYPE"]}}
							 ]
			}

			C_COM.requestQuery(parm, function(resultData) {

				<@pageId>.setChart(resultData , false)
			});
			
			// STARTASSET 전체 실적
 			//월별 매출 누적합계 , 전월대비 매출 증감분 , 계약 건수(전체)
 			var parm = {
				queryGroup : [{queryId	: "rstMgn.getMyPaymentList"		,requestParm	: {GUBUN:'' , UNIT_TYPE : G_VAL.session.etcUserInfo["UNIT_TYPE"]}}
							 ,{queryId 	: "rstMgn.getContarctCntList"	,requestParm	: {GUBUN:'' , UNIT_TYPE : G_VAL.session.etcUserInfo["UNIT_TYPE"]}}
							 ]
			}

			C_COM.requestQuery(parm, function(resultData) {

				<@pageId>.setChart(resultData ,true)
			});
			
		}
		,setChart : (resultData, starassetAll) =>{

			//월별 매출 누적합계 , 전월대비 매출 증감분
			const paymentListMONTHLY_DATA		=  resultData.data["rstMgn.getMyPaymentList"	];  
			
			let ACCUM_PAYMENT = 0;
			let lastYearThisMonth = 0;
			let thisYearThisMonth = 0;
			//월별 매출 누적합계
			const paymentListMONTHLY_DATA_SUM	=  paymentListMONTHLY_DATA.map( (item,idx, originalArray) => {
				
														if( item.MONTH.indexOf(<@pageId>.lastYear) > -1 ) {
															
															if( isEmpty(item["ACCUM_PAYMENT"] ) ){
																ACCUM_PAYMENT += item["SUM_PAYMENT"];
																item["ACCUM_PAYMENT"] = ACCUM_PAYMENT;
																
																if(Number(item.MONTH) == Number(<@pageId>.lastYearMonth) ){
																	lastYearThisMonth = ACCUM_PAYMENT;
																}
															}
														}
														if( idx == 12)ACCUM_PAYMENT = 0;
														
														if( item.MONTH.indexOf(<@pageId>.thisYear) > -1 ) {
	
															if( Number(item.MONTH) <= Number(<@pageId>.thisYearMonth) ){
																if( isEmpty(item["ACCUM_PAYMENT"] ) ){
																	ACCUM_PAYMENT += item["SUM_PAYMENT"];
																	item["ACCUM_PAYMENT"] = ACCUM_PAYMENT;
																}
															}else{

																if( isEmpty(item["ACCUM_PAYMENT"] ) ){
																	item["ACCUM_PAYMENT"] = 0;
																}
																
															}
															
															if(Number(item.MONTH) ==  Number(<@pageId>.thisYearMonth) ){
																thisYearThisMonth = ACCUM_PAYMENT;
															}

														}	
														return item;
			});
			
			//전월대비 매출 증감분
			let lastSumPayment = 0;// 지난달 수수료
			let thisSumPayment = 0;// 이번달 수수료
			let lastYearSumPayment = 0;//작년 이번달까지 수수료 합계
			let thisYearSumPayment = 0;//올해 이번달까지 수수료 합계
  			const paymentListINCDEC_DATA_SUM	=  paymentListMONTHLY_DATA.map( (item,idx, originalArray) => {
				
														if( item.MONTH.indexOf(<@pageId>.lastYear) > -1 ) {
															
															if( isEmpty(item["INCDEC_PAYMENT"] ) ){

																thisSumPayment = item["SUM_PAYMENT"];
																//item["INCDEC_PAYMENT"] = lastSumPayment == 0 ? 0 : (thisSumPayment-lastSumPayment)*100/lastSumPayment;
																item["INCDEC_PAYMENT"] = (thisSumPayment-lastSumPayment);
																
																lastSumPayment = item["SUM_PAYMENT"];
																
																if(Number(item.MONTH) <= Number(<@pageId>.lastYearMonth) ){
																	lastYearSumPayment += item["SUM_PAYMENT"];
																}

															}
														}
														
														//if( idx == 12)ACCUM_PAYMENT = 0;
														
														if( item.MONTH.indexOf(<@pageId>.thisYear) > -1 ) {
	
															if( Number(item.MONTH) <= Number(<@pageId>.thisYearMonth) ){

																if( isEmpty(item["INCDEC_PAYMENT"] ) ){
																	thisSumPayment = item["SUM_PAYMENT"];
																	//item["INCDEC_PAYMENT"] = lastSumPayment == 0 ? 0 : (thisSumPayment-lastSumPayment)*100/lastSumPayment;
																	item["INCDEC_PAYMENT"] = (thisSumPayment-lastSumPayment);
																	
																	lastSumPayment = item["SUM_PAYMENT"];
																}
																
															}else{

																if( isEmpty(item["INCDEC_PAYMENT"] ) ){
																	item["INCDEC_PAYMENT"] = 0;
																}
																
															}
															
															if(Number(item.MONTH) <=  Number(<@pageId>.thisYearMonth) ){
																thisYearSumPayment += item["SUM_PAYMENT"];
															}

														}	
														return item;
			});	
			
			//계약 건수(전체)
			let lastYearSumContractCnt = 0;//작년 이번달까지 계약건수 합계
			let thisYearSumContractCnt = 0;//올해 이번달까지 계약건수 합계
			const contractCntMONTHLY_DATA		=  resultData.data["rstMgn.getContarctCntList"	];  
			
  			contractCntMONTHLY_DATA.forEach( (item,idx, originalArray) => {
				
				if( item.MONTH.indexOf(<@pageId>.lastYear) > -1 ) {
					
						if(Number(item.MONTH) <= Number(<@pageId>.lastYearMonth) ){
							lastYearSumContractCnt += item["CONTRACT_CNT"];
						}

				}
				
				if( item.MONTH.indexOf(<@pageId>.thisYear) > -1 ) {

					if(Number(item.MONTH) <=  Number(<@pageId>.thisYearMonth) ){
						thisYearSumContractCnt += item["CONTRACT_CNT"];
					}

				}	
				return item;
			});				
 
			const getPaymentByMonth					=  paymentListMONTHLY_DATA_SUM.map( (item,idx) =>  item.ACCUM_PAYMENT );
			const getPaymentINCDECByMonth			=  paymentListINCDEC_DATA_SUM.map((item,idx) =>   item.INCDEC_PAYMENT );
			const getContractCntByMonth				=  contractCntMONTHLY_DATA.map( (item,idx) =>   item.CONTRACT_CNT );
		    
			const thisYear 							= <@pageId>.thisYear;
			const lastYear 							= <@pageId>.lastYear;
			const myResult							= [	"<@pageId>_monthlySI_chart","<@pageId>_monthlySII_chart","<@pageId>_monthlyCC_chart"];
			const starassetResult					= [	"<@pageId>_monthlySI_ALLchart","<@pageId>_monthlySII_ALLchart","<@pageId>_monthlyCC_ALLchart"];
			const containerList 					= starassetAll ? starassetResult : myResult;
			const categoriesList 					= [  _monthArray,_monthArray,_monthArray ];
			const seriesList		= [
										[
										 {  name: thisYear+'년',type: 'column',	data: getPaymentByMonth.slice(12)	,tooltip: {valueSuffix: ' '+<@pageId>.getUnitStr('억원',G_VAL.session.etcUserInfo["UNIT_TYPE"])},yAxis: 0}
										,{  name: lastYear+'년',type: 'line',	data: getPaymentByMonth.slice(0,12)	,tooltip: {valueSuffix: ' '+<@pageId>.getUnitStr('억원',G_VAL.session.etcUserInfo["UNIT_TYPE"])}}
										],
				 						[
										 {  name: thisYear+'년',type: 'column',	data: getPaymentINCDECByMonth.slice(12)	,tooltip: {valueSuffix: ' '+<@pageId>.getUnitStr('억원',G_VAL.session.etcUserInfo["UNIT_TYPE"])},yAxis: 0}
										,{  name: lastYear+'년',type: 'line',	data: getPaymentINCDECByMonth.slice(0,12),tooltip: {valueSuffix: ' '+<@pageId>.getUnitStr('억원',G_VAL.session.etcUserInfo["UNIT_TYPE"])}}
										],
										[
										 {  name: thisYear+'년',type: 'column',	data: getContractCntByMonth.slice(12)	,tooltip: {valueSuffix: ' 건'},yAxis: 0}
										,{  name: lastYear+'년',type: 'line',	data: getContractCntByMonth.slice(0,12)	,tooltip: {valueSuffix:	' 건'}}
										],
									 ];

			<@pageId>.createChart( containerList[0] , categoriesList[0] , seriesList[0], <@pageId>.getUnitStr('억',G_VAL.session.etcUserInfo["UNIT_TYPE"]));
			<@pageId>.createChart( containerList[1] , categoriesList[1] , seriesList[1], <@pageId>.getUnitStr('억',G_VAL.session.etcUserInfo["UNIT_TYPE"]));
			<@pageId>.createChart( containerList[2] , categoriesList[2] , seriesList[2], '건');
			
 			let sum = getPaymentByMonth.slice(12).reduce((accumulator, currentValue) => accumulator + currentValue, 0);
 			if( starassetAll )	$("#<@pageId>_monthly_sumPaymentALL").text(sum.toLocaleString() + <@pageId>.getUnitStr('억원',G_VAL.session.etcUserInfo["UNIT_TYPE"])) ;
 			else 				$("#<@pageId>_monthly_sumPayment").text(sum.toLocaleString() + <@pageId>.getUnitStr('억원',G_VAL.session.etcUserInfo["UNIT_TYPE"])) ;

			let growth = Number(lastYearThisMonth)==0 ? 0 : (Number(thisYearThisMonth)-Number(lastYearThisMonth))*100/Number(lastYearThisMonth);
			if( starassetAll )	$("#<@pageId>_monthly_sumPaymentALL").parents("div").siblings(".percent").text(growth >= 0 ? "+"+growth.toFixed(2)+"%": "-"+growth.toFixed(2)+"%") ;
			else 				$("#<@pageId>_monthly_sumPayment").parents("div").siblings(".percent").text(growth >= 0 ? "+"+growth.toFixed(2)+"%": "-"+growth.toFixed(2)+"%") ;
			
			if( Number(thisYearThisMonth)-Number(lastYearThisMonth) < 0){
				if(  starassetAll )	$("#<@pageId>_monthly_sumPaymentALL").parents("div").siblings(".percent").addClass("minus");
				else 				$("#<@pageId>_monthly_sumPayment").parents("div").siblings(".percent").addClass("minus");
			}else {
				if(  starassetAll )	$("#<@pageId>_monthly_sumPaymentALL").parents("div").siblings(".percent").removeClass("minus");
				else				$("#<@pageId>_monthly_sumPayment").parents("div").siblings(".percent").removeClass("minus");
			}
////////////
					
			sum = getPaymentINCDECByMonth.slice(12).reduce((accumulator, currentValue) => accumulator + currentValue, 0);
			if( starassetAll )	$("#<@pageId>_monthly_sumIncomeIncreaseALL").text(sum.toLocaleString() + <@pageId>.getUnitStr('억원',G_VAL.session.etcUserInfo["UNIT_TYPE"])) ;
			else				$("#<@pageId>_monthly_sumIncomeIncrease").text(sum.toLocaleString() + <@pageId>.getUnitStr('억원',G_VAL.session.etcUserInfo["UNIT_TYPE"])) ;
			
			let incdec = Number(lastYearSumPayment)==0 ? 0 : (Number(thisYearSumPayment)-Number(lastYearSumPayment))*100/Number(lastYearSumPayment);
			if( starassetAll )	$("#<@pageId>_monthly_sumIncomeIncreaseALL").parents("div").siblings(".percent").text(incdec >= 0 ? "+"+incdec.toFixed(2)+"%": "-"+incdec.toFixed(2)+"%") ;
			else				$("#<@pageId>_monthly_sumIncomeIncrease").parents("div").siblings(".percent").text(incdec >= 0 ? "+"+incdec.toFixed(2)+"%": "-"+incdec.toFixed(2)+"%") ;
			
			if( Number(thisYearSumPayment)-Number(lastYearSumPayment) < 0){
				if( starassetAll )	$("#<@pageId>_monthly_sumIncomeIncreaseALL").parents("div").siblings(".percent").addClass("minus");
				else				$("#<@pageId>_monthly_sumIncomeIncrease").parents("div").siblings(".percent").addClass("minus");
			}else{
				if( starassetAll )	$("#<@pageId>_monthly_sumIncomeIncreaseALL").parents("div").siblings(".percent").removeClass("minus");
				else				$("#<@pageId>_monthly_sumIncomeIncrease").parents("div").siblings(".percent").removeClass("minus");
			}
////////////			
			sum = getContractCntByMonth.slice(12).reduce((accumulator, currentValue) => accumulator + currentValue, 0);
			if( starassetAll )	$("#<@pageId>_monthly_cntContractALL").text(sum.toLocaleString() + '건') ;
			else				$("#<@pageId>_monthly_cntContract").text(sum.toLocaleString() + '건') ;

			incdec = Number(lastYearSumContractCnt)==0 ? 0 : (Number(thisYearSumContractCnt)-Number(lastYearSumContractCnt))*100/Number(lastYearSumContractCnt);
			if( starassetAll )	$("#<@pageId>_monthly_cntContractALL").parents("div").siblings(".percent").text(incdec >= 0 ? "+"+incdec.toFixed(2)+"%": "-"+toFixed.toFix(2)+"%") ;
			else				$("#<@pageId>_monthly_cntContract").parents("div").siblings(".percent").text(incdec >= 0 ? "+"+incdec.toFixed(2)+"%": "-"+toFixed.toFix(2)+"%") ;

			if( Number(thisYearSumContractCnt)-Number(lastYearSumContractCnt) < 0){
				if( starassetAll )	$("#<@pageId>_monthly_cntContractALL").parents("div").siblings(".percent").addClass("minus");
				else				$("#<@pageId>_monthly_cntContract").parents("div").siblings(".percent").addClass("minus");
			}else{
				if( starassetAll )	$("#<@pageId>_monthly_cntContractALL").parents("div").siblings(".percent").removeClass("minus");
				else				$("#<@pageId>_monthly_cntContract").parents("div").siblings(".percent").removeClass("minus");
			}
			
			_setRemoveHighChartCredits();
	
		}
		,getUnitStr : (str, gubun) =>{
			
			if( str == "억원"){
				
				if( gubun == 'SMALL')return "백만원";
				else return str;
				
			}
			if( str == "억"){
				
				if( gubun == 'SMALL')return "백만";
				else return str;
				
			}
		} 
	}
	
	// Page Load가 완료된후 실행 된다.
	C_PM.onLoadPage("<@pageId>", function() {

		<@pageId>.pageInit();
		setTimeout( ()=>{<@pageId>.chartInit();},700)
		
	});	
	// History back으로 이동해왔을 경우 이루틴이 실행된다.
	C_HM.onReturn("<@pageId>", function(pageId, data) {

	});
</script>
<div class="cont_wrap">
	<div class="cont_top">
		<h2><i class="icon_bullet"></i>내 실적</h2>
	</div>
	<div class="sec_scroll">
		<section class="sec_wrap">
			<div class="cont_box col3">
				<h3>월별 매출 누적합계</h3>
				<div class="price"><span  id="<@pageId>_monthly_sumPayment">13,844,381,010</span></div>
				<span class="prepare">전년 대비</span><span class="percent">+2.2%</span>

				<figure class="highcharts-figure">
			    	<div class="chart"  id="<@pageId>_monthlySI_chart"  style="width:100%; height:280px; margin:0 auto"></div>
				</figure>
			</div>
			<div class="cont_box col3">
				<h3>전월대비 매출 증감분</h3>
				<div class="price"><span  id="<@pageId>_monthly_sumIncomeIncrease">+100,356,153</span></div>
				<span class="prepare">전년 대비</span><span class="percent">+95%</span>

				<figure class="highcharts-figure">
			    	<div class="chart2" id="<@pageId>_monthlySII_chart" style="width:100%; height:280px; margin:0 auto"></div>
				</figure>
			</div>
			<div class="cont_box col3">
				<h3>계약 건수(전체)</h3>
				<div class="price"><span  id="<@pageId>_monthly_cntContract">106</span></div>
				<span class="prepare">전년 대비</span><span class="percent minus">-2.2%</span>

				<figure class="highcharts-figure">
			    	<div class="chart3"  id="<@pageId>_monthlyCC_chart" style="width:100%; height:280px; margin:0 auto"></div>
				</figure>
			</div>
		</section>

	<div class="cont_top" style='margin-top:40px;'>
		<h2><i class="icon_bullet"></i>STARASSET 전체 실적</h2>
	</div>
	<div class="sec_scroll">
		<section class="sec_wrap">
			<div class="cont_box col3">
				<h3>월별 매출 누적합계</h3>
				<div class="price"><span  id="<@pageId>_monthly_sumPaymentALL">13,844,381,010</span></div>
				<span class="prepare">전년 대비</span><span class="percent">+2.2%</span>

				<figure class="highcharts-figure">
			    	<div class="chart"  id="<@pageId>_monthlySI_ALLchart"  style="width:100%; height:280px; margin:0 auto"></div>
				</figure>
			</div>
			<div class="cont_box col3">
				<h3>전월대비 매출 증감분</h3>
				<div class="price"><span  id="<@pageId>_monthly_sumIncomeIncreaseALL">+100,356,153</span></div>
				<span class="prepare">전년 대비</span><span class="percent">+95%</span>

				<figure class="highcharts-figure">
			    	<div class="chart2" id="<@pageId>_monthlySII_ALLchart" style="width:100%; height:280px; margin:0 auto"></div>
				</figure>
			</div>
			<div class="cont_box col3">
				<h3>계약 건수(전체)</h3>
				<div class="price"><span  id="<@pageId>_monthly_cntContractALL">106</span></div>
				<span class="prepare">전년 대비</span><span class="percent minus">-2.2%</span>

				<figure class="highcharts-figure">
			    	<div class="chart3"  id="<@pageId>_monthlyCC_ALLchart" style="width:100%; height:280px; margin:0 auto"></div>
				</figure>
			</div>
		</section>
</div>
</div>
